const { Telegraf, Markup } = require('telegraf');

// Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð±Ð¾Ñ‚Ð°
const bot = new Telegraf(process.env.BOT_TOKEN);

// Ð¥Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð² Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
const userResponses = {};

// Ð¤Ð¸Ñ€Ð¼ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ñ€Ð°Ð·Ñ‹ KonnCode
const brandPhrases = [
  "âœ¨ ÐŸÐ¾Ð¼Ð½Ð¸: ÐºÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ ÐºÐ¾Ð´ = ÐºÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ ÑÐ°Ð¹Ñ‚",
  "ðŸŽ¨ ÐŸÑ€Ð¾ÐµÐºÑ‚Ð¸Ñ€ÑƒÑŽ ÐºÐ°Ðº Ñ…ÑƒÐ´Ð¾Ð¶Ð½Ð¸Ðº, ÐºÐ¾Ð´Ð¸Ñ€ÑƒÑŽ ÐºÐ°Ðº Ð¿ÐµÑ€Ñ„ÐµÐºÑ†Ð¸Ð¾Ð½Ð¸ÑÑ‚", 
  "ðŸ›  ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð¿Ð¸ÐºÑÐµÐ»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð½Ð° ÑÐ²Ð¾ÐµÐ¼ Ð¼ÐµÑÑ‚Ðµ",
  "âš¡ I don't just code - I draw with code!",
  "ðŸŒŸ Ð¢Ð²Ð¾Ð¹ ÑÐ°Ð¹Ñ‚ - ÑÑ‚Ð¾ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð¾Ð¹ Ð¿Ð¾Ñ€Ñ‚Ñ€ÐµÑ‚ Ð±Ð¸Ð·Ð½ÐµÑÐ°",
  "ðŸ’« ÐŸÑ€ÐµÐ²Ñ€Ð°Ñ‰Ð°ÑŽ Ð¸Ð´ÐµÐ¸ Ð² Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ñ‹Ðµ ÑˆÐµÐ´ÐµÐ²Ñ€Ñ‹",
  "ðŸŽ¯ ÐŸÐ¸ÐºÑÐµÐ»ÑŒ-Ð¿ÐµÑ€Ñ„ÐµÐºÑ‚ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ"
];

// ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ Ñ„Ð¸Ñ€Ð¼ÐµÐ½Ð½ÑƒÑŽ Ñ„Ñ€Ð°Ð·Ñƒ
function getRandomBrandPhrase() {
  return brandPhrases[Math.floor(Math.random() * brandPhrases.length)];
}

// ==================== ÐšÐžÐœÐÐÐ”Ð /start ====================
bot.start(async (ctx) => {
  const chatId = ctx.message.chat.id;
  userResponses[chatId] = {
    step: 1,
    answers: {},
    startTime: new Date()
  };
  
  await ctx.replyWithMarkdownV2(`\
ðŸŽ¨ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² PixelKonnstructor 

Ð¢Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²Ð¾Ð´Ð½Ð¸Ðº Ð² Ð¼Ð¸Ñ€Ðµ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… ÑÐ°Ð¹Ñ‚Ð¾Ð²

âœ¨ ÐœÐ¾Ñ Ñ„Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ: I draw with code\\!
ðŸŽ¯ ÐœÐ¾Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´: ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¿Ð¸ÐºÑÐµÐ»ÑŒ Ð½Ð° ÑÐ²Ð¾ÐµÐ¼ Ð¼ÐµÑÑ‚Ðµ
ðŸ’« ÐœÐ¾Ñ Ð¼Ð¸ÑÑÐ¸Ñ: Ð¿Ñ€ÐµÐ²Ñ€Ð°Ñ‚Ð¸Ñ‚ÑŒ Ñ‚Ð²Ð¾ÑŽ Ð¸Ð´ÐµÑŽ Ð² Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð¾Ð¹ ÑˆÐµÐ´ÐµÐ²Ñ€

Ð“Ð¾Ñ‚Ð¾Ð² ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ€Ð°ÑÑÐºÐ°Ð¶ÐµÑ‚ Ñ‚Ð²Ð¾ÑŽ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ?

ðŸ“Œ Ð’Ð¾Ð¿Ñ€Ð¾Ñ 1/6:
ÐšÐ°Ðº Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð¸Ð»Ð¸ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ?`);

  // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ñ„Ð¸Ñ€Ð¼ÐµÐ½Ð½ÑƒÑŽ Ñ„Ñ€Ð°Ð·Ñƒ
  setTimeout(() => {
    ctx.reply(getRandomBrandPhrase());
  }, 1500);
});

// ==================== ÐžÐ‘Ð ÐÐ‘ÐžÐ¢ÐšÐ ÐžÐ¢Ð’Ð•Ð¢ÐžÐ’ ====================
bot.on('text', async (ctx) => {
  const chatId = ctx.message.chat.id;
  const text = ctx.message.text;

  // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð½Ð°Ñ‡Ð°Ð» Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð´Ð¸Ð°Ð»Ð¾Ð³
  if (!userResponses[chatId]) {
    return ctx.reply('ðŸŽ¨ ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð½Ð°Ñ‡Ð½Ð¸ Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start');
  }

  const userData = userResponses[chatId];
  const currentStep = userData.step;

  try {
    switch (currentStep) {
      case 1: // ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
        userData.answers.projectName = text;
        userData.step = 2;
        
        await ctx.replyWithMarkdownV2(`ðŸ’« ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾\\! \"${text}\" - Ð·Ð²ÑƒÑ‡Ð¸Ñ‚ Ð¸Ð½Ñ‚Ñ€Ð¸Ð³ÑƒÑŽÑ‰Ðµ\\!

${getRandomBrandPhrase()}

ðŸŽ¯ Ð’Ð¾Ð¿Ñ€Ð¾Ñ 2/6:
ÐšÐ°ÐºÐ°Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ†ÐµÐ»ÑŒ ÑÐ°Ð¹Ñ‚Ð°?`);

        // ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Ñ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð°Ð¼Ð¸ Ñ†ÐµÐ»ÐµÐ¹
        await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¸Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ ÑÐ²Ð¾Ð¹:', Markup.keyboard([
          ['ðŸ›’ ÐŸÑ€Ð¾Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹/ÑƒÑÐ»ÑƒÐ³Ð¸', 'ðŸ“ž ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ð·Ð°ÑÐ²ÐºÐ¸'],
          ['ðŸ¢ ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸ÑŽ', 'âœï¸ Ð’ÐµÑÑ‚Ð¸ Ð±Ð»Ð¾Ð³'],
          ['ðŸŽ¨ ÐŸÐ¾Ñ€Ñ‚Ñ„Ð¾Ð»Ð¸Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚', 'ðŸš€ Ð”Ñ€ÑƒÐ³Ð¾Ðµ']
        ]).oneTime().resize());
        break;

      case 2: // Ð¦ÐµÐ»ÑŒ ÑÐ°Ð¹Ñ‚Ð°
        userData.answers.goal = text;
        userData.step = 3;
        
        await ctx.replyWithMarkdownV2(`ðŸ“Š ÐŸÐ¾Ð½ÑÐ»Ð° Ñ†ÐµÐ»ÑŒ\\! 
\"${text}\" - Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ð¾Ñ€Ð¸ÐµÐ½Ñ‚Ð¸Ñ€ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

${getRandomBrandPhrase()}

ðŸ’° Ð’Ð¾Ð¿Ñ€Ð¾Ñ 3/6:
ÐšÐ°ÐºÐ¾Ð¹ Ð±ÑŽÐ´Ð¶ÐµÑ‚ Ð½Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ°Ð¹Ñ‚Ð°?`, Markup.removeKeyboard());

        // ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Ñ Ð±ÑŽÐ´Ð¶ÐµÑ‚Ð°Ð¼Ð¸
        await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½:', Markup.keyboard([
          ['ðŸ’Ž Ð´Ð¾ 30 Ñ‚Ñ‹Ñ. Ñ€ÑƒÐ±.', 'ðŸš€ 30-70 Ñ‚Ñ‹Ñ. Ñ€ÑƒÐ±.'],
          ['ðŸŽ¯ Ð±Ð¾Ð»ÐµÐµ 70 Ñ‚Ñ‹Ñ. Ñ€ÑƒÐ±.', 'ðŸ¤ ÐÑƒÐ¶Ð½Ð° ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸Ñ']
        ]).oneTime().resize());
        break;

      case 3: // Ð‘ÑŽÐ´Ð¶ÐµÑ‚
        userData.answers.budget = text;
        userData.step = 4;
        
        await ctx.replyWithMarkdownV2(`ðŸ’¼ Ð‘ÑŽÐ´Ð¶ÐµÑ‚ \"${text}\" - Ñ ÑÐ¼Ð¾Ð³Ñƒ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ\\!

${getRandomBrandPhrase()}

â±ï¸ Ð’Ð¾Ð¿Ñ€Ð¾Ñ 4/6:
Ð’ ÐºÐ°ÐºÐ¸Ðµ ÑÑ€Ð¾ÐºÐ¸ Ð½ÑƒÐ¶ÐµÐ½ ÑÐ°Ð¹Ñ‚?`, Markup.removeKeyboard());

        // ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° ÑÐ¾ ÑÑ€Ð¾ÐºÐ°Ð¼Ð¸
        await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚:', Markup.keyboard([
          ['âš¡ Ð¡Ñ€Ð¾Ñ‡Ð½Ð¾ (Ð´Ð¾ 2 Ð½ÐµÐ´ÐµÐ»ÑŒ)', 'ðŸ“… Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾ (1 Ð¼ÐµÑÑÑ†)'],
          ['ðŸ• ÐÐµ ÑÐ¿ÐµÑˆÐ° (2+ Ð¼ÐµÑÑÑ†Ð°)', 'ðŸ—“ï¸ ÐŸÐ¾ÐºÐ° Ð½Ðµ Ð·Ð½Ð°ÑŽ']
        ]).oneTime().resize());
        break;

      case 4: // Ð¡Ñ€Ð¾ÐºÐ¸
        userData.answers.deadline = text;
        userData.step = 5;
        
        await ctx.replyWithMarkdownV2(`ðŸ“… Ð¡Ñ€Ð¾Ðº \"${text}\" - ÑƒÑ‡Ñ‚Ñƒ Ð¿Ñ€Ð¸ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹\\!

${getRandomBrandPhrase()}

ðŸŽ¨ Ð’Ð¾Ð¿Ñ€Ð¾Ñ 5/6:
Ð•ÑÑ‚ÑŒ Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ñ Ð¿Ð¾ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ðµ?`, Markup.removeKeyboard());

        // ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Ñ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°Ð¼Ð¸
        await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚:', Markup.keyboard([
          ['ðŸ’» Ð§Ð¸ÑÑ‚Ñ‹Ð¹ ÐºÐ¾Ð´ (HTML/CSS/JS)', 'âš™ï¸ Tilda'],
          ['ðŸŽ¨ Figma Ð¼Ð°ÐºÐµÑ‚', 'ðŸ¤· ÐŸÐ¾ÐºÐ° Ð½Ðµ Ð·Ð½Ð°ÑŽ']
        ]).oneTime().resize());
        break;

      case 5: // ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°
        userData.answers.platform = text;
        userData.step = 6;
        
        await ctx.replyWithMarkdownV2(`ðŸ”§ \"${text}\" - Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€\\!

${getRandomBrandPhrase()}

âœ¨ Ð’Ð¾Ð¿Ñ€Ð¾Ñ 6/6:
ÐžÑÑ‚Ð°Ð²ÑŒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚ Ð´Ð»Ñ ÑÐ²ÑÐ·Ð¸`, Markup.removeKeyboard());

        await ctx.reply('ðŸ“ž Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½, email Ð¸Ð»Ð¸ username Ð² Telegram:');
        break;

      case 6: // ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚
        userData.answers.contact = text;
        userData.answers.completionTime = new Date();
        
        // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ
        await sendFinalMessage(ctx, userData.answers);
        
        // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ
        await sendAdminNotification(ctx, userData.answers);
        
        // ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
        delete userResponses[chatId];
        break;
    }
  } catch (error) {
    console.error('ÐžÑˆÐ¸Ð±ÐºÐ°:', error);
    ctx.reply('ðŸ›  Ð£Ð¿Ñ! Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ ÑÐ½Ð¾Ð²Ð°: /start');
  }
});

// ==================== Ð¤Ð˜ÐÐÐ›Ð¬ÐÐžÐ• Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð• ====================
async function sendFinalMessage(ctx, answers) {
  const finalMessage = `\
ðŸŽ¨ Ð¡ÐŸÐÐ¡Ð˜Ð‘Ðž Ð—Ð ÐžÐ¢Ð’Ð•Ð¢Ð«\\!

Ð¢Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð¿Ñ€Ð¸Ð½ÑÑ‚ Ð² Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ PixelKonnstructor

Ð¢Ð²Ð¾Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ ÑÑ‚Ð°Ð»Ð¸ Ð¾ÑÐ½Ð¾Ð²Ð¾Ð¹ Ð´Ð»Ñ Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ³Ð¾ ÑˆÐµÐ´ÐµÐ²Ñ€Ð°:
ðŸ¢ ÐŸÑ€Ð¾ÐµÐºÑ‚: ${answers.projectName}
ðŸŽ¯ Ð¦ÐµÐ»ÑŒ: ${answers.goal}  
ðŸ’° Ð‘ÑŽÐ´Ð¶ÐµÑ‚: ${answers.budget}
â± Ð¡Ñ€Ð¾ÐºÐ¸: ${answers.deadline}
ðŸ”§ ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°: ${answers.platform}
ðŸ“ž ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚: ${answers.contact}

âœ¨ Ð§Ñ‚Ð¾ Ð´Ð°Ð»ÑŒÑˆÐµ?
1\\. Ð¯ Ð¸Ð·ÑƒÑ‡Ð°ÑŽ Ñ‚Ð²Ð¾Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ð´ÑƒÐ¼Ñ‹Ð²Ð°ÑŽ ÐºÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸ÑŽ
2\\. Ð¡Ð¾Ð·Ð´Ð°ÑŽ ÑÑÐºÐ¸Ð· Ð¸ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÑŽ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸  
3\\. Ð¡Ð²ÑÐ·Ñ‹Ð²Ð°ÑŽÑÑŒ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 24 Ñ‡Ð°ÑÐ¾Ð² Ð´Ð»Ñ Ð¾Ð±ÑÑƒÐ¶Ð´ÐµÐ½Ð¸Ñ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹

ðŸ›  ÐŸÐ¾Ð¼Ð½Ð¸: Ñ Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÐºÐ¾Ð´ÐµÑ€ \\- Ñ Ñ…ÑƒÐ´Ð¾Ð¶Ð½Ð¸Ðº Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð°
ðŸ’« I draw with code \\- Ð¸ Ñ‚Ð²Ð¾Ð¹ ÑÐ°Ð¹Ñ‚ ÑÑ‚Ð°Ð½ÐµÑ‚ Ð¼Ð¾Ð¸Ð¼ Ð½Ð¾Ð²Ñ‹Ð¼ Ñ…Ð¾Ð»ÑÑ‚Ð¾Ð¼\\!

Ð¡ ÑƒÐ²Ð°Ð¶ÐµÐ½Ð¸ÐµÐ¼,
ÐœÐ°Ñ€Ð¸Ñ ÐšÐ¾Ð½Ð½Ð¾Ð²Ð° \\(KonnCode\\)
ÐÐ²Ñ‚Ð¾Ñ€ PixelKonnstructor

ðŸ’Œ P\\.S\\. Ð¢Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾ ÑÑ‚Ð°Ð» Ñ‡Ð°ÑÑ‚ÑŒÑŽ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð¾Ð³Ð¾ Ð¸ÑÐºÑƒÑÑÑ‚Ð²Ð°\\!`;

  await ctx.replyWithMarkdownV2(finalMessage);
}

// ==================== Ð£Ð’Ð•Ð”ÐžÐœÐ›Ð•ÐÐ˜Ð• ÐÐ”ÐœÐ˜ÐÐ˜Ð¡Ð¢Ð ÐÐ¢ÐžÐ Ð£ ====================
async function sendAdminNotification(ctx, answers) {
  const adminChatId = process.env.ADMIN_CHAT_ID;
  
  if (!adminChatId) {
    console.log('ADMIN_CHAT_ID Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½');
    return;
  }

  const notification = `\
ðŸŽ‰ ÐÐžÐ’ÐÐ¯ Ð—ÐÐ¯Ð’ÐšÐ Ð’ PIXELKONNSTRUCTOR

ðŸ‘¤ ÐšÐ»Ð¸ÐµÐ½Ñ‚: ${ctx.message.from.first_name} ${ctx.message.from.last_name || ''} 
ðŸ“± Username: @${ctx.message.from.username || 'Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½'}
ðŸ†” ID: ${ctx.message.from.id}
ðŸ“ž ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚: ${answers.contact}

Ð”Ð•Ð¢ÐÐ›Ð˜ ÐŸÐ ÐžÐ•ÐšÐ¢Ð:
ðŸ¢ ÐŸÑ€Ð¾ÐµÐºÑ‚: ${answers.projectName}
ðŸŽ¯ Ð¦ÐµÐ»ÑŒ: ${answers.goal}
ðŸ’° Ð‘ÑŽÐ´Ð¶ÐµÑ‚: ${answers.budget}  
â± Ð¡Ñ€Ð¾ÐºÐ¸: ${answers.deadline}
ðŸ”§ ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°: ${answers.platform}

âš¡ I draw with code \\- time to create magic\\!`;

  try {
    await ctx.telegram.sendMessage(adminChatId, notification, { 
      parse_mode: 'MarkdownV2',
      reply_markup: {
        inline_keyboard: [[
          { text: 'ðŸ’Œ ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ', url: tg://user?id=${ctx.message.from.id} }
        ]]
      }
    });
  } catch (error) {
    console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ:', error);
  }
}

// ==================== ÐšÐžÐœÐÐÐ”Ð /help ====================
bot.help((ctx) => {
  ctx.replyWithMarkdownV2(`\
ðŸ›  PixelKonnstructor \\- Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ

Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:
/start \\- Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¾Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
/help \\- Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÑ‚Ñƒ ÑÐ¿Ñ€Ð°Ð²ÐºÑƒ

Ðž Ð±Ð¾Ñ‚Ðµ:
PixelKonnstructor \\- ÑÑ‚Ð¾ Ð¸Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… ÑÐ°Ð¹Ñ‚Ð¾Ð² Ð¾Ñ‚ ÐœÐ°Ñ€Ð¸Ð¸ ÐšÐ¾Ð½Ð½Ð¾Ð²Ð¾Ð¹ \\(KonnCode\\)

âœ¨ Ð¤Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ: I draw with code\\!
ðŸŽ¨ ÐŸÐ¾Ð´Ñ…Ð¾Ð´: Ð¿Ð¸ÐºÑÐµÐ»ÑŒ\\-Ð¿ÐµÑ€Ñ„ÐµÐºÑ‚

ÐŸÐ¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð°:
ðŸ’Œ ÐÐ°Ð¿Ð¸ÑˆÐ¸ Ð¼Ð½Ðµ @KonnCode`);
});

// ==================== ÐžÐ‘Ð ÐÐ‘ÐžÐ¢ÐšÐ Ð¡Ð¢Ð˜ÐšÐ•Ð ÐžÐ’ Ð˜ Ð”Ð Ð£Ð“Ð˜Ð¥ Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð™ ====================
bot.on('sticker', (ctx) => ctx.reply('ðŸŽ¨ ÐšÑ€ÑƒÑ‚Ð¾Ð¹ ÑÑ‚Ð¸ÐºÐµÑ€! ÐÐ¾ Ð´Ð°Ð²Ð°Ð¹ Ð»ÑƒÑ‡ÑˆÐµ Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð¼ Ð¾ Ñ‚Ð²Ð¾Ñ‘Ð¼ Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼ ÑÐ°Ð¹Ñ‚Ðµ ðŸ˜Š'));
bot.on('photo', (ctx) => ctx.reply('ðŸ–¼ Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾Ðµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ! ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð¾Ð¿Ð¸ÑÐ°Ñ‚ÑŒ, ÐºÐ°ÐºÐ¾Ð¹ ÑÑ‚Ð¸Ð»ÑŒ Ñ‚ÐµÐ±Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ Ð´Ð»Ñ ÑÐ°Ð¹Ñ‚Ð°?'));

// ==================== ÐžÐ‘Ð ÐÐ‘ÐžÐ¢ÐšÐ ÐžÐ¨Ð˜Ð‘ÐžÐš ====================
bot.catch((err, ctx) => {
  console.error(ÐžÑˆÐ¸Ð±ÐºÐ° Ð´Ð»Ñ ${ctx.updateType}:, err);
  ctx.reply('ðŸ›  Ð£Ð¿Ñ! ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ ÑÐ½Ð¾Ð²Ð°: /start');
});

// ==================== Ð—ÐÐŸÐ£Ð¡Ðš Ð‘ÐžÐ¢Ð ====================
bot.launch().then(() => {
  console.log('ðŸŽ¨ PixelKonnstructor Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð¸ Ð³Ð¾Ñ‚Ð¾Ð² Ðº Ñ‚Ð²Ð¾Ñ€Ñ‡ÐµÑÑ‚Ð²Ñƒ!');
}).catch(err => {
  console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð°:', err);
});

// ==================== Ð“Ð ÐÐ¦Ð˜ÐžÐ—ÐÐžÐ• Ð’Ð«ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• ====================
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));

module.exports = bot;
